window.NERDZCrush=function(){var self=this;self.version=1,self.domain="https://media.nerdz.eu/",self.maxMediaWidth=-1,self.maxMediaHeight=-1,self.preserveAspectRatio=!0;var createRequest=function(method,url){var xhr=new XMLHttpRequest;return xhr.open(method,self.domain+url),xhr.setRequestHeader("X-CORS-Status","true"),xhr},createMediaObject=function(blob){return blob.status=null,blob.url=self.domain+"/"+blob.hash,blob.update=function(callback){self.checkStatus(blob.hash,function(value,result){if("done"==value)for(prop in result[blob.hash])blob[prop]=result[blob.hash][prop];blob.status=value,callback&&callback(blob)})},blob["delete"]=function(callback){self["delete"](blob.hash,function(value){callback&&callback(value)})},blob.wait=function(callback){"processing"!=blob.status?callback&&callback(blob):setTimeout(function(){blob.update(function(a){a.wait(callback)})},1e3)},blob},renderImage=function(target,media,callback){var image=document.createElement("img");image.src=self.domain+media.files[0].file,-1!=self.maxMediaWidth&&(image.style.maxWidth=self.maxMediaWidth),-1!=self.maxMediaHeight&&(image.style.maxHeight=self.maxMediaHeight),target.appendChild(image),target.classList.remove("nerdzcrush"),target.classList.add("nerdzcrush-processed"),callback&&callback(target,media)},iframes={},renderMedia=function(target,media,options,callback){var iframe=document.createElement("iframe"),src=self.domain+"/"+media.hash+"/frame";""!=options&&(src+="#"+options),iframe.src=src,iframe.setAttribute("style","position:relative;width:100%;"),iframe.setAttribute("frameborder",0),iframe.setAttribute("scrolling","no"),iframe.setAttribute("allowFullscreen","true"),iframes[media.hash]={frame:iframe,media:media,callback:callback},target.appendChild(iframe),target.classList.remove("nerdzcrush"),target.classList.add("nerdzcrush-processed")};return window.addEventListener("message",function(e){var frame=iframes[e.data.media];if(frame){var width=e.data.width,height=e.data.height;if(0>=width||0>=height)return;var aspectRatio=width/height;if("application/album"!=frame.media.mimetype){if(-1!=self.maxMediaWidth&&width>maxMediaWidth){var difference=maxMediaWidth/width;width=maxMediaWidth,self.preserveAspectRatio&&(height*=difference)}if(-1!=self.maxMediaHeight&&height>maxMediaHeight){var difference=maxMediaHeight/height;height=maxMediaHeight,self.preserveAspectRatio&&(width*=difference)}if(self.preserveAspectRatio&&aspectRatio!=width/height)return;frame.frame.width=width,frame.frame.height=height}frame.callback&&frame.callback(frame.frame.parentElement,frame.media)}},!1),self.get=function(hashes,callback){var xhr;xhr=hashes instanceof Array?createRequest("GET","/api/info?list="+hashes.join(",")):createRequest("GET","/api/"+hashes),xhr.onload=function(){if(callback){var result=JSON.parse(this.responseText);if(hashes instanceof Array){var array=[],dictionary={};for(blob in result)if(12==blob.length)if(null==result[blob])array.push(result[blob]),dictionary[blob]=result[blob],result[blob].hash=blob,dictionary[blob].hash=blob;else{var media=createMediaObject(result[blob]);media.hash=blob,array.push(media),dictionary[blob]=media}callback&&callback(array,dictionary)}else if(callback){var media=createMediaObject(result);media.hash=hashes,callback(media)}}},xhr.send()},self.exists=function(hash,callback){var xhr=createRequest("GET","/api/"+hash+"/exists");xhr.onload=function(){callback&&callback(JSON.parse(this.responseText).exists)},xhr.send()},self["delete"]=function(hash,callback){var xhr=createRequest("DELETE","/api/"+hash);xhr.onload=function(){var result=JSON.parse(this.responseText);callback&&callback(200==result["x-status"])},xhr.onerror=function(){callback&&callback(!1)},xhr.send()},self.checkStatus=function(hash,callback){var xhr=createRequest("GET","/api/"+hash+"/status");xhr.onload=function(){var result=JSON.parse(this.responseText);callback&&callback(result["x-status"],result)},xhr.send()},self.upload=function(file,callback,onprogress){var xhr,formData=new FormData;file instanceof File?(xhr=createRequest("POST","/api/upload/file"),formData.append("file",file)):(xhr=createRequest("POST","/api/upload/url"),formData.append("url",file)),xhr.upload.onprogress=onprogress,xhr.onload=function(){var json=JSON.parse(this.responseText),blob={hash:json.hash};409==json["x-status"]?blob.status="done":blob.status="processing",callback&&callback(createMediaObject(blob))},xhr.send(formData)},self.render=function(element,callback){var hash=element.getAttribute("data-media"),options="";12==hash.indexOf("#")&&(options=hash.split("#")[1],hash=hash.split("#")[0]),self.get(hash,function(media){0==media.type.indexOf("image/")&&"image/gif"!=media.type?renderImage(element,media,callback):renderMedia(element,media,options,callback)})},self.renderAll=function(){for(var elements=document.querySelectorAll("div.nerdzcrush"),hashes=[],i=0;i<elements.length;i++){var hash=elements[i].getAttribute("data-media");hash&&(12==hash.indexOf("#")&&(hash=hash.split("#")[0]),hashes.push(hash))}0!=hashes.length&&self.get(hashes,function(array,result){for(var i=0;i<elements.length;i++){var hash=elements[i].getAttribute("data-media"),options="";12==hash.indexOf("#")&&(options=hash.split("#")[1],hash=hash.split("#")[0]),hash&&result[hash]&&(0==result[hash].type.indexOf("image/")&&"image/gif"!=result[hash].type?renderImage(elements[i],result[hash]):renderMedia(elements[i],result[hash],options))}})},self.play=function(media){var hash=media.getAttribute("data-media");iframes[hash]&&iframes[hash].frame.contentWindow.postMessage({action:"play"},"*")},self.pause=function(media){var hash=media.getAttribute("data-media");iframes[hash]&&iframes[hash].frame.contentWindow.postMessage({action:"pause"},"*")},self}(),window.addEventListener("load",function(){window.preventNERDZCrushAutoload||(window.beforeNERDZCrushLoad&&window.beforeNERDZCrushLoad(),NERDZCrush.renderAll())},!1);
